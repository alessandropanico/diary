/* src/app/diario/diario.page.scss */

@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap');

/* --- Variabili e Sfondo Generale --- */
:host {
  /* Nuovi valori per un glow più freddo e un background più scuro */
  --primary-glow: #00d4ff; /* Ciano brillante per accenti */
  --secondary-glow: #00ff7b; /* Verde-blu per un tocco diverso (opzionale) */
  --bg-dark-primary: #0a1128; /* Blu molto scuro quasi nero */
  --bg-dark-secondary: #0c1a3b; /* Blu scuro */
  --panel-bg: rgba(10, 20, 40, 0.9); /* Sfondo dei pannelli semi-trasparente */
  --border-color-light: rgba(0, 212, 255, 0.4); /* Bordo leggero per elementi */
  --text-primary: #e0f7fa; /* Testo principale chiaro */
  --text-secondary: #a0c4ff; /* Testo secondario, meno brillante */
  --placeholder-color: #7abeff; /* Colore placeholder */
  --danger-color: #ff4e4e; /* Colore errore */

  font-family: 'Orbitron', sans-serif;
  color: var(--text-primary);
}

.ff7-background {
  background: linear-gradient(145deg, var(--bg-dark-primary) 0%, var(--bg-dark-secondary) 100%);
  background-attachment: fixed; /* Per mantenere lo sfondo fisso durante lo scroll */
}

/* --- Effetti Generali --- */
.ff7-glow-text {
  color: var(--primary-glow);
  text-shadow: 0 0 10px rgba(0, 212, 255, 0.7), 0 0 20px rgba(0, 212, 255, 0.3);
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 15px; /* Spazio sotto i titoli di sezione */
}

.ff7-panel {
  background: var(--panel-bg);
  border: 1px solid var(--border-color-light);
  border-radius: 8px; /* Leggermente meno squadrato, più ergonomico */
  box-shadow: 0 0 15px rgba(0, 212, 255, 0.1);
  backdrop-filter: blur(8px); /* Effetto blur più pronunciato */
  padding: 20px;
  transition: all 0.3s ease-in-out;
  position: relative; /* Per elementi con posizione assoluta all'interno */
  overflow: hidden; /* Per mascherare eventuali overflow del contenuto */
  display: flex; // Aggiunto per Flexbox
  flex-direction: column; // Aggiunto per Flexbox
  // height: 100%; // Rimosso o gestito diversamente per evitare conflitti con grow dinamica

  &:hover {
    box-shadow: 0 0 25px rgba(0, 212, 255, 0.3);
    // transform: translateY(-2px); // Rimosso come da richiesta precedente
  }

  /* Bordo animato per i pannelli */
  &::before {
    content: '';
    position: absolute;
    top: -2px; left: -2px; right: -2px; bottom: -2px;
    background: linear-gradient(45deg, #00d4ff, #00b8ff, #00ff7b);
    z-index: -1;
    border-radius: 10px;
    filter: blur(8px);
    opacity: 0.2;
    transition: opacity 0.3s ease;
  }

  &:hover::before {
    opacity: 0.2; // Mantiene l'opacità bassa, non la aumenta
    filter: blur(12px); // Oppure si può aumentare solo il blur per dare feedback
  }
}

/* --- Layout Principale (Grid) --- */
.diario-main-grid {
  display: grid;
  gap: 20px; /* Spazio tra i pannelli */
  padding: 20px; /* Padding interno del container */
  align-items: stretch; /* Importante: allunga gli item per riempire l'altezza della riga */

  /* Layout per schermi grandi (desktop/tablet orizzontale) */
  @media (min-width: 768px) {
    grid-template-columns: 1fr 2fr; /* Colonna sinistra più piccola della destra */
    grid-template-rows: auto 1fr; /* La prima riga è auto (pannelli), la seconda è 1fr (storico) */
    grid-template-areas:
      "left-panel right-panel"
      "history-section history-section"; /* Storico sotto a larghezza piena */
  }

  /* Layout per schermi piccoli (mobile/tablet verticale) */
  @media (max-width: 767px) {
    grid-template-columns: 1fr;
    grid-template-areas:
      "left-panel"
      "right-panel"
      "history-section";
  }
}

.left-panel {
  grid-area: left-panel;
  display: flex; /* Transforma in flex container */
  flex-direction: column; /* Impila gli elementi verticalmente */
  gap: 20px; /* Spazio tra i pannelli interni (data e umore) */
}

.right-panel {
  grid-area: right-panel;
  display: flex; /* Transforma in flex container */
  flex-direction: column; /* Impila gli elementi verticalmente */
}

.history-section {
  grid-area: history-section;
}

/* --- Selettore Data --- */
.date-section {
  .date-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }

  .date-display-button {
    flex-grow: 1;
    text-align: center;
    margin: 0 10px;
    transition: all 0.2s ease;

    // IMPORTE: Forza la trasparenza del background del bottone host
    --background: transparent !important;
    --background-hover: transparent !important; // Anche lo sfondo all'hover
    --background-activated: transparent !important; // E quando attivato/cliccato
    --background-focused: transparent !important; // E quando in focus
    --box-shadow: none !important; // Rimuove qualsiasi ombra predefinita
    --border-radius: 0 !important; // Rimuove border-radius predefiniti se ne ha

    // Proprietà Custom per il colore del testo principale
    --color: var(--primary-glow);

    --padding-start: 0;
    --padding-end: 0;
    --padding-top: 0;
    --padding-bottom: 0;

    // Per il testo interno specifico (attraverso Shadow DOM)
    &::part(native) {
      font-size: 1.4em;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(0, 212, 255, 0.7);
      font-family: 'Orbitron', sans-serif;
      // Forza il background dell'elemento nativo a essere trasparente
      background: transparent !important;
      // Rimuovi eventuali bordi di default dall'interno del bottone nativo
      border: none !important;
    }

    &:hover {
      // Questi stili si applicano al testo interno tramite ::part(native)
      // ma il --color sull'host dovrebbe comunque funzionare
      --color: var(--primary-glow);
      &::part(native) {
         text-shadow: 0 0 15px rgba(0, 212, 255, 0.9), 0 0 25px rgba(0, 212, 255, 0.5);
      }
    }
  }

  .nav-button {
    --padding-start: 12px;
    --padding-end: 12px;
    --color: var(--text-secondary);
    font-size: 1.5em;
    transition: color 0.2s ease, transform 0.2s ease, text-shadow 0.2s ease;

    &:hover {
      color: var(--text-secondary);
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.7), 0 0 20px rgba(0, 212, 255, 0.3);
      transform: scale(1.1);
    }
  }
}

/* --- Modale Data Time --- */
ion-modal {
  --background: var(--bg-dark-primary);
  --backdrop-opacity: 0.7;
  --box-shadow: 0 0 30px rgba(0, 212, 255, 0.6);
  --border-radius: 10px;

  .modal-wrapper {
    background: var(--bg-dark-primary) !important;
  }
}

ion-datetime {
  --background: black;
  --color: var(--text-primary);
  --border-color: var(--primary-glow);
  --highlight-color: var(--primary-glow);
  --highlight-background: rgba(0, 212, 255, 0.2);
  font-family: 'Orbitron', sans-serif;

  .datetime-button {
    color: var(--text-primary);
    &.datetime-selected {
      color: var(--primary-glow);
    }
  }

  &::part(calendar-day),
  &::part(year-button),
  &::part(month-year-button),
  &::part(native) {
    background: black !important;
    color: var(--text-primary) !important;
  }

  &::part(calendar-day-header) {
    background: black !important;
    color: var(--primary-glow) !important;
    font-weight: bold;
  }

  &::part(calendar-day-selected) {
    background: var(--primary-glow) !important;
    color: var(--bg-dark-primary) !important;
  }

  &::part(calendar-body) {
    background: black !important;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.1);
  }

  &::part(calendar-day):hover {
    background: rgba(0, 0, 0, 0.8) !important;
    color: var(--primary-glow) !important;
    border: 1px solid var(--primary-glow);
    box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
  }

  &::part(year-button):hover,
  &::part(month-year-button):hover {
    background: rgba(0, 0, 0, 0.8) !important;
    color: var(--primary-glow) !important;
    text-shadow: 0 0 8px var(--primary-glow);
  }

  :host ::ng-deep ion-datetime {
    --background: black !important;
    --color: var(--text-primary);
    --border-color: var(--primary-glow);
    --highlight-color: var(--primary-glow);
    --highlight-background: rgba(0, 212, 255, 0.2);
  }
}

/* --- Sezione Umore --- */
.mood-tracker-section {
  flex-grow: 1; /* Permette alla sezione di espandersi per riempire lo spazio rimanente nel left-panel */
  // Rimosso ion-margin-top nel HTML per una gestione più pulita del gap

  .mood-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;

    .mood-button {
      --background: rgba(0, 0, 0, 0.4);
      --border-color: var(--border-color-light);
      --color: var(--text-secondary);
      --ripple-color: var(--primary-glow);
      border-radius: 4px;
      font-family: 'Orbitron', sans-serif;
      text-transform: uppercase;
      font-weight: 500;
      padding: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
      font-size: 0.8em;

      ion-icon {
        font-size: 1.8em;
        color: var(--text-secondary);
        transition: color 0.2s ease;
      }

      span {
        white-space: nowrap;
      }

      &.selected {
        --background: linear-gradient(135deg, var(--primary-glow), rgba(0, 212, 255, 0.4));
        border: 1px solid var(--primary-glow);
        box-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
        --color: var(--bg-dark-primary);
        transform: scale(1.05);
        ion-icon {
          color: var(--bg-dark-primary);
        }
      }

      &:hover:not(.selected) {
        --background: rgba(0, 0, 0, 0.5);
        border-color: var(--primary-glow);
        --color: var(--text-secondary);
        ion-icon {
          color: var(--text-secondary);
        }
        box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
      }
    }
  }
}

/* --- Sezione Nota --- */
.note-section {
  flex-grow: 1; /* Permette a questa sezione di espandersi */
  display: flex; /* Aggiunto per Flexbox */
  flex-direction: column; /* Aggiunto per Flexbox */

  .ff7-textarea {
    --background: rgba(0, 0, 0, 0.6);
    --color: var(--text-primary);
    --placeholder-color: var(--placeholder-color);
    --padding-start: 15px;
    --padding-end: 15px;
    --padding-top: 15px;
    --padding-bottom: 15px;
    border: 1px solid var(--border-color-light);
    border-radius: 5px;
    box-shadow: inset 0 0 10px rgba(0, 212, 255, 0.08);
    font-size: 1rem;
    line-height: 1.7;
    caret-color: var(--primary-glow);
    transition: all 0.2s ease;
    min-height: 150px; /* Altezza minima, ma flex-grow la estenderà */
    height: 100%; /* Importante per farla riempire il contenitore flessibile */
    flex-grow: 1; /* Permette alla textarea di espandersi per riempire lo spazio */

    // Allineamento verticale del testo all'inizio
    textarea {
      vertical-align: top;
      height: 100% !important; // Sovrascrive Ionic per l'altezza
    }

    &:focus {
      border-color: var(--primary-glow);
      box-shadow: inset 0 0 20px rgba(0, 212, 255, 0.3), 0 0 15px rgba(0, 212, 255, 0.3);
      background: rgba(0, 0, 0, 0.7);
      color: var(--text-primary);
    }
  }
}

/* --- Sezione Storico --- */
.history-section {

  .history-list {
    background: transparent;
    padding-top: 10px;
  }

  .ff7-item {
    --background: rgba(0, 0, 0, 0.4);
    --inner-border-width: 0px;
    border-bottom: 1px dashed rgba(0, 212, 255, 0.2);
    margin-bottom: 10px;
    border-radius: 4px;
    padding: 15px;
    box-shadow: 0 0 8px rgba(0, 212, 255, 0.08);
    transition: all 0.2s ease;

    &:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    &:hover {
      background: rgba(0, 0, 0, 0.5);
      box-shadow: 0 0 15px rgba(0, 212, 255, 0.2);
      color: var(--text-primary);
    }
  }

  .ff7-label-text {
    color: var(--text-secondary);
    font-size: 0.9em;
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 0.5px;
  }
}

/* --- Spinner (già ben fatto) --- */
ion-spinner {
  width: 60px;
  height: 60px;
  color: var(--primary-glow);
  filter: drop-shadow(0 0 10px var(--primary-glow));
  animation: ff7-pulse 1.2s infinite ease-in-out;
}

@keyframes ff7-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.7;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}
